<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ËÇ•Ê©òË≤ìÁàÜÁ†¥Áéã v8.0 (Á©©ÂÆöÁâà)</title>
<style>
    html, body { margin:0; padding:0; width:100%; height:100%; overflow:hidden; position:fixed; background:#222; font-family:'Segoe UI',sans-serif; color:white; touch-action:none; -webkit-user-select:none; user-select:none; }
    #main-wrapper { display:flex; flex-direction:column; align-items:center; justify-content:center; width:100%; height:100%; }
    #hud { width:100%; max-width:600px; padding:8px 15px; background:#333; display:flex; justify-content:space-between; align-items:center; border-bottom:2px solid #555; font-weight:bold; font-size:0.9rem; flex-shrink:0; }
    .ammo-box { color:#f1c40f; border:1px solid #f1c40f; padding:2px 8px; border-radius:4px; }
    #reload-btn { background:#0984e3; color:white; border:none; padding:5px 12px; border-radius:4px; font-weight:bold; font-size:0.9rem; animation:pulse 2s infinite; }
    @keyframes pulse { 0%{transform:scale(1)} 50%{transform:scale(1.05)} 100%{transform:scale(1)} }
    #stage { position:relative; width:90vmin; height:90vmin; max-width:600px; max-height:600px; background:#555; border:4px solid #000; overflow:hidden; margin:5px 0; }
    .cell { position:absolute; width:6.66%; height:6.66%; display:flex; justify-content:center; align-items:center; font-size:1.5rem; }
    .wall { background:#333; border:1px solid #222; box-shadow:inset 0 0 5px #000; }
    .brick { background:#e17055; border:2px solid #d63031; transition:0.2s; }
    .door { background:#000; border:2px dashed #fff; } 
    .key { font-size:1.5rem; animation:float 1s infinite alternate; }
    @keyframes float { from{transform:translateY(0)} to{transform:translateY(-5px)} }
    #player { position:absolute; width:6.66%; height:6.66%; z-index:20; display:flex; justify-content:center; align-items:center; font-size:2rem; transition:top 0.1s linear, left 0.1s linear; text-shadow:2px 2px 4px rgba(0,0,0,0.5); }
    .enemy { position:absolute; width:6.66%; height:6.66%; z-index:15; font-size:1.5rem; text-align:center; transition:top 0.3s linear, left 0.3s linear; }
    .bomb { position:absolute; width:5%; height:5%; margin:0.8%; z-index:10; background:#2d3436; border-radius:50%; border:2px solid #fff; animation:tick 0.5s infinite alternate; }
    .fire { position:absolute; width:6.66%; height:6.66%; z-index:12; background:rgba(255,200,0,0.8); }
    @keyframes tick { from{transform:scale(0.9)} to{transform:scale(1.1)} }
    #controls { width:100%; max-width:500px; height:160px; display:flex; justify-content:space-between; align-items:center; padding:0 30px; flex-shrink:0; }
    .dpad { position:relative; width:140px; height:140px; }
    .dbtn { position:absolute; width:50px; height:50px; background:rgba(255,255,255,0.15); border:2px solid rgba(255,255,255,0.4); border-radius:8px; }
    .dbtn:active { background:rgba(255,255,255,0.5); }
    .du { top:0; left:45px; } .dd { bottom:0; left:45px; } .dl { top:45px; left:0; } .dr { top:45px; right:0; }
    .act-btn { width:90px; height:90px; border-radius:50%; background:#d63031; border:4px solid #fab1a0; display:flex; justify-content:center; align-items:center; font-size:2.5rem; box-shadow:0 5px 0 #8c1c1c; }
    .act-btn:active { transform:translateY(5px); box-shadow:none; }
    #quiz-layer { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); z-index:100; display:none; justify-content:center; align-items:center; }
    .card { background:white; color:#333; width:90%; max-width:450px; padding:15px; border-radius:15px; max-height:95vh; overflow-y:auto; text-align:center; position:relative; }
    .word { font-size:2rem; color:#d63031; font-weight:800; margin:0; }
    .meta { color:#666; margin:5px 0 10px 0; display:flex; justify-content:center; align-items:center; gap:10px; }
    .btn-audio { border:1px solid #ccc; background:#eee; border-radius:15px; padding:4px 12px; font-size:0.9rem; cursor:pointer; }
    .sent-box { background:#f1f2f6; padding:10px; border-radius:8px; text-align:left; margin-bottom:10px; border-left:5px solid #0984e3; display:none; max-height:200px; overflow-y:auto; }
    .sent-row { margin-bottom:8px; border-bottom:1px dashed #ccc; padding-bottom:5px; }
    .en-text { font-weight:bold; font-size:1rem; color:#2d3436; }
    .cn-text { color:#636e72; font-size:0.9rem; margin-top:2px; }
    .opt-btn { width:100%; padding:12px; margin:5px 0; border:1px solid #ccc; background:#fff; border-radius:8px; font-size:1rem; text-align:left; font-weight:bold; }
    .opt-btn.correct { background:#00b894; color:white; border-color:#00b894; }
    .opt-btn.wrong { background:#d63031; color:white; border-color:#d63031; }
    #close-quiz-btn { display:none; width:100%; padding:12px; margin-top:10px; background:#0984e3; color:white; border:none; border-radius:8px; font-size:1.1rem; font-weight:bold; }
</style>
</head>
<body>
    <div id="main-wrapper">
        <div id="hud">
            <span>‚ù§Ô∏è<span id="ui-hp">3</span></span> <span>Lv.<span id="ui-lv">1</span></span>
            <span>üîë<span id="ui-key">0</span></span> <span class="ammo-box">üí£<span id="ui-ammo">5</span></span>
            <button id="reload-btn" onclick="triggerQuiz()">+ Ë£úÁµ¶</button>
        </div>
        <div id="stage">
            <div id="layer-grid"></div><div id="layer-item"></div>
            <div id="layer-obj"></div><div id="layer-ent"></div><div id="player">üê±</div>
        </div>
        <div id="controls">
            <div class="dpad">
                <div class="dbtn du" ontouchstart="input.u=true;e.preventDefault()" ontouchend="input.u=false"></div>
                <div class="dbtn dd" ontouchstart="input.d=true;e.preventDefault()" ontouchend="input.d=false"></div>
                <div class="dbtn dl" ontouchstart="input.l=true;e.preventDefault()" ontouchend="input.l=false"></div>
                <div class="dbtn dr" ontouchstart="input.r=true;e.preventDefault()" ontouchend="input.r=false"></div>
            </div>
            <div class="act-btn" ontouchstart="placeBomb();e.preventDefault()">üí£</div>
        </div>
    </div>
    <div id="quiz-layer">
        <div class="card">
            <div style="font-size:0.8rem;color:#aaa">TOEIC Ë®òÊÜ∂ÁâπË®ì</div>
            <h1 class="word" id="q-w">Word</h1>
            <div class="meta"><span id="q-p">/pho/</span><span id="q-t">n.</span><button class="btn-audio" onclick="speak('word')">üîä</button></div>
            <div id="opt-box"></div>
            <div id="learn-area" class="sent-box">
                <div id="sent-content"></div>
                <button class="btn-audio" style="width:100%;margin-top:5px" onclick="speak('sent')">üîä Êí≠Êîæ‰æãÂè•</button>
            </div>
            <button id="close-quiz-btn" onclick="closeQuiz()">‚úÖ ÊàëË®ò‰Ωè‰∫Ü</button>
        </div>
    </div>
<script>
// Èò≤Ë™§Ëß∏
document.addEventListener('touchmove',e=>e.preventDefault(),{passive:false});
document.addEventListener('gesturestart',e=>e.preventDefault());
document.addEventListener('dblclick',e=>e.preventDefault());

// === Â§ßÈáèË≥áÊñôÂ∫´ (300+ ÁµÑ) ===
const RAW=[
"Agenda|n.|Ë≠∞Á®ã|set agenda^Ë®≠ÂÆöË≠∞Á®ã^agenda item^Ë≠∞Á®ãÈ†ÖÁõÆ^hidden agenda^Èö±ËóèÁöÑÂãïÊ©ü",
"Budget|n.|È†êÁÆó|tight budget^È†êÁÆóÂêÉÁ∑ä^over budget^Ë∂ÖÂá∫È†êÁÆó^budget cut^Âà™Ê∏õÈ†êÁÆó",
"Colleague|n.|Âêå‰∫ã|senior colleague^Ë≥áÊ∑±Âêå‰∫ã^trusted colleague^‰ø°Ë≥¥ÁöÑÂêå‰∫ã^meet colleague^Ë¶ãÂêå‰∫ã",
"Deadline|n.|ÊúüÈôê|meet deadline^Ë∂ï‰∏äÊúüÈôê^miss deadline^ÈåØÈÅéÊúüÈôê^tight deadline^Á∑äËø´ÊúüÈôê",
"Executive|n.|‰∏ªÁÆ°|chief executive^Âü∑Ë°åÈï∑^senior executive^Ë≥áÊ∑±‰∏ªÁÆ°^account executive^Ê•≠ÂãôÂ∞àÂì°",
"Feedback|n.|ÂõûÈ•ã|give feedback^Áµ¶‰∫àÂõûÈ•ã^positive feedback^Ê≠£Èù¢ÂõûÈ•ã^customer feedback^ÂÆ¢Êà∂ÂõûÈ•ã",
"Guarantee|v.|‰øùË≠â|satisfaction guaranteed^‰øùË≠âÊªøÊÑè^money back^ÈÄÄÊ¨æ‰øùË≠â^under guarantee^‰øùÂõ∫ÂÖß",
"Implement|v.|ÂØ¶ÊñΩ|implement plan^ÂØ¶ÊñΩË®àÁï´^implement changes^ÂØ¶ÊñΩËÆäÊõ¥^fully implement^ÂÆåÂÖ®ÂØ¶ÊñΩ",
"Lucrative|adj.|Ë≥∫Èå¢ÁöÑ|lucrative deal^Ë≥∫Èå¢ÁöÑ‰∫§Êòì^lucrative market^Âà©ÊΩ§Ë±êÂéöÁöÑÂ∏ÇÂ†¥^lucrative job^ËÇ•Áº∫",
"Merger|n.|Âêà‰Ωµ|merger acquisition^‰ΩµË≥º^proposed merger^ÊèêË≠∞ÁöÑÂêà‰Ωµ^merger talks^Âêà‰ΩµË´áÂà§",
"Negotiate|v.|Ë´áÂà§|negotiate price^Ë´áÂà§ÂÉπÊ†º^negotiate contract^Ë´áÂà§ÂêàÁ¥Ñ^negotiate terms^Ë´áÂà§Ê¢ùÊ¨æ",
"Recruit|v.|ÊãõÂãü|recruit staff^ÊãõÂãüÂì°Â∑•^actively recruit^Á©çÊ•µÊãõÂãü^new recruit^Êñ∞ÂÖµ",
"Resume|n.|Â±•Ê≠∑|submit resume^Êèê‰∫§Â±•Ê≠∑^send resume^ÂØÑÂ±•Ê≠∑^resume sample^Â±•Ê≠∑ÁØÑÊú¨",
"Penalty|n.|ÁΩ∞Ê¨æ|pay penalty^‰ªòÁΩ∞Ê¨æ^death penalty^Ê≠ªÂàë^face penalty^Èù¢Ëá®ËôïÁΩ∞",
"Itinerary|n.|Ë°åÁ®ã|travel itinerary^ÊóÖÈÅäË°åÁ®ã^plan itinerary^Ë¶èÂäÉË°åÁ®ã^detailed itinerary^Ë©≥Á¥∞Ë°åÁ®ã",
"Asset|n.|Ë≥áÁî¢|valuable asset^ÂØ∂Ë≤¥Ë≥áÁî¢^liquid asset^ÊµÅÂãïË≥áÁî¢^company asset^ÂÖ¨Âè∏Ë≥áÁî¢",
"Deficit|n.|Ëµ§Â≠ó|trade deficit^Ë≤øÊòìËµ§Â≠ó^budget deficit^È†êÁÆóËµ§Â≠ó^reduce deficit^Ê∏õÂ∞ëËµ§Â≠ó",
"Portfolio|n.|‰ΩúÂìÅÈõÜ|investment portfolio^ÊäïË≥áÁµÑÂêà^design portfolio^Ë®≠Ë®à‰ΩúÂìÅÈõÜ^build portfolio^Âª∫Á´ã‰ΩúÂìÅÈõÜ",
"Refund|n.|ÈÄÄÊ¨æ|full refund^ÂÖ®È°çÈÄÄÊ¨æ^demand refund^Ë¶ÅÊ±ÇÈÄÄÊ¨æ^non-refundable^‰∏çÂèØÈÄÄÊ¨æ",
"Valid|adj.|ÊúâÊïàÁöÑ|valid passport^ÊúâÊïàË≠∑ÁÖß^valid reason^Ê≠£Áï∂ÁêÜÁî±^remain valid^‰øùÊåÅÊúâÊïà",
"Acquire|v.|Êî∂Ë≥º|acquire company^Êî∂Ë≥ºÂÖ¨Âè∏^acquire skills^Áç≤ÂæóÊäÄËÉΩ^acquire knowledge^Áç≤ÂèñÁü•Ë≠ò",
"Capacity|n.|ÂÆπÈáè|full capacity^ÊªøËºâ^storage capacity^ÂÑ≤Â≠òÂÆπÈáè^seating capacity^Â∫ß‰ΩçÊï∏",
"Collaborate|v.|Âêà‰Ωú|collaborate with^Ëàá...Âêà‰Ωú^close collaboration^ÂØÜÂàáÂêà‰Ωú^collaborate on^Âêà‰ΩúÊüê‰∫ã",
"Fluctuate|v.|Ê≥¢Âãï|prices fluctuate^ÂÉπÊ†ºÊ≥¢Âãï^market fluctuates^Â∏ÇÂ†¥Ê≥¢Âãï^fluctuate wildly^ÂäáÁÉàÊ≥¢Âãï",
"Mandatory|adj.|Âº∑Âà∂ÁöÑ|mandatory training^Âº∑Âà∂Ë®ìÁ∑¥^mandatory retirement^Âº∑Âà∂ÈÄÄ‰ºë^it is mandatory^ÈÄôÊòØÂº∑Âà∂ÁöÑ",
"Launch|v.|ÁôºÂ∏É|product launch^Áî¢ÂìÅÁôºÂ∏É^launch campaign^ÁôºËµ∑Ê¥ªÂãï^launch date^ÁôºÂ∏ÉÊó•",
"Nominate|v.|ÊèêÂêç|nominate candidate^ÊèêÂêçÂÄôÈÅ∏‰∫∫^be nominated^Ë¢´ÊèêÂêç^nominate for award^ÊèêÂêçÁçéÈ†Ö",
"Renovate|v.|Êï¥‰øÆ|renovate house^Êï¥‰øÆÊàøÂ≠ê^newly renovated^Êñ∞Ë£ù‰øÆÁöÑ^closed for renovation^Êï¥‰øÆÈóúÈñâ",
"Allocate|v.|ÂàÜÈÖç|allocate funds^ÂàÜÈÖçË≥áÈáë^allocate resources^ÂàÜÈÖçË≥áÊ∫ê^allocate time^ÂàÜÈÖçÊôÇÈñì",
"Brochure|n.|Â∞èÂÜäÂ≠ê|read brochure^Èñ±ËÆÄÂ∞èÂÜäÂ≠ê^travel brochure^ÊóÖÈÅäÊâãÂÜä^print brochure^Âç∞Ë£ΩÊâãÂÜä",
"Comply|v.|ÈÅµÂÆà|comply with rules^ÈÅµÂÆàË¶èÂâá^fail to comply^Êú™ËÉΩÈÅµÂÆà^strict compliance^Âö¥Ê†ºÈÅµÂÆà",
"Expansion|n.|Êì¥Âºµ|business expansion^Ê•≠ÂãôÊì¥Âºµ^rapid expansion^Âø´ÈÄüÊì¥Âºµ^overseas expansion^Êµ∑Â§ñÊì¥Âºµ",
"Fiscal|adj.|Ë≤°ÊîøÁöÑ|fiscal year^ÊúÉË®àÂπ¥Â∫¶^fiscal policy^Ë≤°ÊîøÊîøÁ≠ñ^fiscal crisis^Ë≤°ÊîøÂç±Ê©ü",
"Gross|adj.|Á∏ΩÂÖ±ÁöÑ|gross income^Á∏ΩÊî∂ÂÖ•^gross profit^ÊØõÂà©^gross weight^Á∏ΩÈáç",
"Inspect|v.|Ê™¢Êü•|inspect goods^Ê™¢Êü•Ë≤®Áâ©^inspect site^Ë¶ñÂØüÁèæÂ†¥^closely inspect^‰ªîÁ¥∞Ê™¢Êü•",
"Kickoff|n.|ÈñãÂßã|kickoff meeting^ÂïüÂãïÊúÉË≠∞^project kickoff^Â∞àÊ°àÂïüÂãï^kickoff time^ÈñãË≥ΩÊôÇÈñì",
"Logistics|n.|Áâ©ÊµÅ|handle logistics^ËôïÁêÜÁâ©ÊµÅ^logistics company^Áâ©ÊµÅÂÖ¨Âè∏^logistics manager^Áâ©ÊµÅÁ∂ìÁêÜ",
"Monopoly|n.|Â£üÊñ∑|market monopoly^Â∏ÇÂ†¥Â£üÊñ∑^have a monopoly^ÊìÅÊúâÂ£üÊñ∑Ê¨ä^break monopoly^ÊâìÁ†¥Â£üÊñ∑",
"Overhead|n.|ÈñãÊîØ|reduce overhead^Ê∏õÂ∞ëÁ∂ìÂ∏∏ÈñãÊîØ^overhead costs^ÁáüÈÅãÊàêÊú¨^low overhead^‰ΩéÁáüÈÅãÊàêÊú¨",
"Patent|n.|Â∞àÂà©|file patent^Áî≥Ë´ãÂ∞àÂà©^patent pending^Â∞àÂà©Áî≥Ë´ã‰∏≠^patent lawyer^Â∞àÂà©ÂæãÂ∏´",
"Quarterly|adj.|Â≠£Â∫¶ÁöÑ|quarterly report^Â≠£Â∫¶Â†±Âëä^quarterly meeting^Â≠£Â∫¶ÊúÉË≠∞^paid quarterly^ÊåâÂ≠£ÊîØ‰ªò",
"Revenue|n.|ÁáüÊî∂|annual revenue^Âπ¥Â∫¶ÁáüÊî∂^generate revenue^Áî¢ÁîüÁáüÊî∂^tax revenue^Á®ÖÊî∂",
"Strategy|n.|Á≠ñÁï•|marketing strategy^Ë°åÈä∑Á≠ñÁï•^business strategy^ÂïÜÊ•≠Á≠ñÁï•^develop strategy^ÁôºÂ±ïÁ≠ñÁï•",
"Trademark|n.|ÂïÜÊ®ô|register trademark^Ë®ªÂÜäÂïÜÊ®ô^trademark infringement^ÂïÜÊ®ô‰æµÊ¨ä^company trademark^ÂÖ¨Âè∏ÂïÜÊ®ô",
"Unanimous|adj.|‰∏ÄËá¥ÁöÑ|unanimous vote^ÂÖ®Á•®ÈÄöÈÅé^unanimous decision^‰∏ÄËá¥Ê±∫ÂÆö^reached agreement^ÈÅîÊàê‰∏ÄËá¥",
"Vacancy|n.|Á©∫Áº∫|job vacancy^ËÅ∑‰ΩçÁ©∫Áº∫^no vacancy^ÂÆ¢Êªø^fill vacancy^Â°´Ë£úÁ©∫Áº∫",
"Warranty|n.|‰øùÂõ∫|under warranty^Âú®‰øùÂõ∫ÂÖß^extended warranty^Âª∂Èï∑‰øùÂõ∫^void warranty^‰øùÂõ∫Â§±Êïà",
"Affordable|adj.|Ë≤†ÊìîÂæóËµ∑|affordable price^ÂØ¶ÊÉ†ÂÉπÊ†º^affordable housing^Á∂ìÊøüÈÅ©Áî®Êàø^make it affordable^‰ΩøÂÖ∂Ë≤†ÊìîÂæóËµ∑",
"Boost|v.|‰øÉÈÄ≤|boost sales^‰øÉÈÄ≤Èä∑ÂîÆ^boost confidence^Â¢ûÂº∑‰ø°ÂøÉ^boost morale^ÊèêÊåØÂ£´Ê∞£",
"Consumer|n.|Ê∂àË≤ªËÄÖ|consumer demand^Ê∂àË≤ªËÄÖÈúÄÊ±Ç^consumer behavior^Ê∂àË≤ªËÄÖË°åÁÇ∫^consumer rights^Ê∂àË≤ªËÄÖÊ¨äÁõä",
"Diverse|adj.|Â§öÊ®£ÁöÑ|diverse culture^Â§öÂÖÉÊñáÂåñ^diverse range^Â§öÊ®£ÁØÑÂúç^diverse background^Â§öÂÖÉËÉåÊôØ",
"Facility|n.|Ë®≠ÊñΩ|sports facility^È´îËÇ≤Ë®≠ÊñΩ^production facility^ÁîüÁî¢Ë®≠ÊñΩ^medical facility^ÈÜ´ÁôÇË®≠ÊñΩ",
"Global|adj.|ÂÖ®ÁêÉÁöÑ|global market^ÂÖ®ÁêÉÂ∏ÇÂ†¥^global economy^ÂÖ®ÁêÉÁ∂ìÊøü^global warming^ÂÖ®ÁêÉÊöñÂåñ",
"Hedge|v.|ÈÅøÈö™|hedge fund^ÈÅøÈö™Âü∫Èáë^hedge against^Ë¶èÈÅø...^hedge risk^Â∞çÊ≤ñÈ¢®Èö™",
"Jeopardize|v.|Âç±Âèä|jeopardize job^Âç±ÂèäÂ∑•‰Ωú^jeopardize safety^Âç±ÂèäÂÆâÂÖ®^jeopardize future^Âç±ÂèäÊú™‰æÜ",
"Liability|n.|Ë≤¨‰ªª|legal liability^Ê≥ïÂæãË≤¨‰ªª^admit liability^ÊâøË™çË≤¨‰ªª^limited liability^ÊúâÈôêË≤¨‰ªª",
"Outsource|v.|Â§ñÂåÖ|outsource work^Â§ñÂåÖÂ∑•‰Ωú^outsource production^Â§ñÂåÖÁîüÁî¢^cost of outsourcing^Â§ñÂåÖÊàêÊú¨",
"Productivity|n.|ÁîüÁî¢Âäõ|increase productivity^ÊèêÈ´òÁîüÁî¢Âäõ^high productivity^È´òÁîüÁî¢Âäõ^productivity tool^ÁîüÁî¢ÂäõÂ∑•ÂÖ∑",
"Quota|n.|ÈÖçÈ°ç|sales quota^Èä∑ÂîÆÈÖçÈ°ç^meet quota^ÈÅîÂà∞ÈÖçÈ°ç^import quota^ÈÄ≤Âè£ÈÖçÈ°ç",
"Recession|n.|Ë°∞ÈÄÄ|economic recession^Á∂ìÊøüË°∞ÈÄÄ^deep recession^Âö¥ÈáçË°∞ÈÄÄ^global recession^ÂÖ®ÁêÉË°∞ÈÄÄ",
"Subsidy|n.|Ë£úË≤º|government subsidy^ÊîøÂ∫úË£úË≤º^farming subsidy^Ëæ≤Ê•≠Ë£úË≤º^apply for subsidy^Áî≥Ë´ãË£úË≤º",
"Tariff|n.|ÈóúÁ®Ö|impose tariff^ÂæµÊî∂ÈóúÁ®Ö^import tariff^ÈÄ≤Âè£ÈóúÁ®Ö^high tariff^È´òÈóúÁ®Ö",
"Venture|n.|ÂÜíÈö™|joint venture^ÂêàË≥á‰ºÅÊ•≠^business venture^ÂïÜÊ•≠ÂÜíÈö™^venture capital^ÂâµÊäïË≥áÊú¨",
"Wholesale|n.|ÊâπÁôº|wholesale price^ÊâπÁôºÂÉπ^wholesale market^ÊâπÁôºÂ∏ÇÂ†¥^buy wholesale^ÊâπÁôºË≥ºË≤∑",
"Appraisal|n.|Ë©ï‰º∞|performance appraisal^Á∏æÊïàË©ï‰º∞^staff appraisal^Âì°Â∑•Ë©ï‰º∞^get appraisal^Áç≤ÂæóË©ï‰º∞",
"Blueprint|n.|ËóçÂúñ|design blueprint^Ë®≠Ë®àËóçÂúñ^blueprint for success^ÊàêÂäüËóçÂúñ^project blueprint^Â∞àÊ°àËóçÂúñ",
"Commission|n.|‰Ω£Èáë|sales commission^Èä∑ÂîÆ‰Ω£Èáë^earn commission^Ë≥∫Âèñ‰Ω£Èáë^commission rate^‰Ω£ÈáëÁéá",
"Delegate|v.|ÂßîÊ¥æ|delegate tasks^ÂßîÊ¥æ‰ªªÂãô^delegate authority^‰∏ãÊîæÊ¨äÂäõ^learn to delegate^Â≠∏ÁøíÂßîÊ¥æ",
"Endorse|v.|ËÉåÊõ∏|endorse product^‰ª£Ë®ÄÁî¢ÂìÅ^endorse check^ËÉåÊõ∏ÊîØÁ•®^fully endorse^ÂÆåÂÖ®ÊîØÊåÅ",
"Feasible|adj.|ÂèØË°åÁöÑ|feasible plan^ÂèØË°åÁöÑË®àÁï´^technically feasible^ÊäÄË°ì‰∏äÂèØË°å^economically feasible^Á∂ìÊøü‰∏äÂèØË°å",
"Inventory|n.|Â∫´Â≠ò|check inventory^Áõ§ÈªûÂ∫´Â≠ò^inventory control^Â∫´Â≠òÁÆ°ÁêÜ^reduce inventory^Ê∏õÂ∞ëÂ∫´Â≠ò",
"Lease|n.|ÁßüÁ¥Ñ|sign lease^Á∞ΩÁΩ≤ÁßüÁ¥Ñ^renew lease^Á∫åÁ¥Ñ^lease agreement^ÁßüË≥ÉÂçîË≠∞",
"Maintenance|n.|Á∂≠Ë≠∑|regular maintenance^ÂÆöÊúüÁ∂≠Ë≠∑^maintenance cost^Á∂≠Ë≠∑ÊàêÊú¨^high maintenance^Èõ£‰º∫ÂÄôÁöÑ",
"Payroll|n.|Ëñ™Ë≥áÂñÆ|payroll department^Ëñ™Ë≥áÈÉ®ÈñÄ^on the payroll^Âú®ËÅ∑‰∫∫Âì°^meet payroll^ÁôºËñ™Ê∞¥",
"Reimburse|v.|Ê†∏Èä∑|reimburse expenses^Ê†∏Èä∑Ë≤ªÁî®^reimburse cost^ÈÄÄÈÇÑÊàêÊú¨^get reimbursed^Áç≤ÂæóÊ†∏Èä∑",
"Tenant|n.|ÊàøÂÆ¢|new tenant^Êñ∞ÊàøÂÆ¢^tenant rights^ÊàøÂÆ¢Ê¨äÁõä^evict tenant^È©ÖÈÄêÊàøÂÆ¢",
"Vendor|n.|‰æõÊáâÂïÜ|preferred vendor^È¶ñÈÅ∏‰æõÊáâÂïÜ^vendor list^‰æõÊáâÂïÜÂêçÂñÆ^street vendor^Ë°óÈ†≠Êî§Ë≤©",
"Defect|n.|Áº∫Èô∑|product defect^Áî¢ÂìÅÁº∫Èô∑^birth defect^ÂÖàÂ§©Áº∫Èô∑^zero defect^Èõ∂Áº∫Èô∑",
"Eligible|adj.|Ë≥áÊ†º|eligible for^ÊúâË≥áÊ†º^eligible voter^ÂêàÊ†ºÈÅ∏Ê∞ë^become eligible^Áç≤ÂæóË≥áÊ†º",
"Forecast|n.|È†êÊ∏¨|weather forecast^Â§©Ê∞£È†êÂ†±^sales forecast^Èä∑ÂîÆÈ†êÊ∏¨^economic forecast^Á∂ìÊøüÈ†êÊ∏¨",
"Invoice|n.|ÁôºÁ•®|issue invoice^ÈñãÁôºÁ•®^pay invoice^‰ªòÁôºÁ•®^invoice amount^ÁôºÁ•®ÈáëÈ°ç",
"Landlord|n.|ÊàøÊù±|pay landlord^‰ªòÊàøÊù±^landlord approval^ÊàøÊù±ÂêåÊÑè^contact landlord^ËÅØÁµ°ÊàøÊù±",
"Pension|n.|ÈÄÄ‰ºëÈáë|pension fund^ÈÄÄ‰ºëÂü∫Èáë^state pension^ÂúãÂÆ∂È§äËÄÅÈáë^pension plan^ÈÄÄ‰ºëË®àÁï´",
"Transaction|n.|‰∫§Êòì|secure transaction^ÂÆâÂÖ®‰∫§Êòì^bank transaction^ÈäÄË°å‰∫§Êòì^online transaction^Á∑ö‰∏ä‰∫§Êòì",
"Acquisition|n.|Êî∂Ë≥º|mergers and acquisitions^‰ΩµË≥º^new acquisition^Êñ∞Êî∂Ë≥º^make acquisition^ÈÄ≤Ë°åÊî∂Ë≥º",
"Benchmark|n.|Âü∫Ê∫ñ|set benchmark^Ë®≠ÂÆöÂü∫Ê∫ñ^quality benchmark^ÂìÅË≥™Âü∫Ê∫ñ^industry benchmark^Ë°åÊ•≠Âü∫Ê∫ñ",
"Competitor|n.|Â∞çÊâã|main competitor^‰∏ªË¶ÅÂ∞çÊâã^beat competitor^ÊìäÊïóÂ∞çÊâã^market competitor^Â∏ÇÂ†¥Á´∂Áà≠ËÄÖ",
"Dividend|n.|ËÇ°Âà©|pay dividend^ÁôºÊîæËÇ°Âà©^stock dividend^ËÇ°Á•®ËÇ°Âà©^annual dividend^Âπ¥Â∫¶ËÇ°Âà©",
"Equity|n.|ËÇ°Ê¨ä|private equity^ÁßÅÂãüËÇ°Ê¨ä^brand equity^ÂìÅÁâåË≥áÁî¢^shareholder equity^ËÇ°Êù±Ê¨äÁõä",
"Hypothesis|n.|ÂÅáË®≠|test hypothesis^Ê∏¨Ë©¶ÂÅáË®≠^working hypothesis^Â∑•‰ΩúÂÅáË®≠^support hypothesis^ÊîØÊåÅÂÅáË®≠",
"Liability|n.|Ë≤¨‰ªª|legal liability^Ê≥ïÂæãË≤¨‰ªª^admit liability^ÊâøË™çË≤¨‰ªª^product liability^Áî¢ÂìÅË≤¨‰ªª",
"Mentoring|n.|ÊåáÂ∞é|mentoring program^Â∞éÂ∏´Ë®àÁï´^provide mentoring^Êèê‰æõÊåáÂ∞é^peer mentoring^ÂêåÂÑïÊåáÂ∞é",
"Network|v.|‰∫∫ËÑà|social network^Á§æ‰∫§Á∂≤Áµ°^computer network^ÈõªËÖ¶Á∂≤Áµ°^build network^Âª∫Á´ã‰∫∫ËÑà",
"Quarter|n.|Â≠£Â∫¶|first quarter^Á¨¨‰∏ÄÂ≠£^fourth quarter^Á¨¨ÂõõÂ≠£^quarterly results^Â≠£Â∫¶ÁµêÊûú",
"Subsidiary|n.|Â≠êÂÖ¨Âè∏|foreign subsidiary^Â§ñÂúãÂ≠êÂÖ¨Âè∏^wholly owned^ÂÖ®Ë≥áÂ≠êÂÖ¨Âè∏^parent company^ÊØçÂÖ¨Âè∏",
"Turnover|n.|ÊµÅÂãïÁéá|staff turnover^Âì°Â∑•ÊµÅÂãïÁéá^high turnover^È´òÊµÅÂãïÁéá^annual turnover^Âπ¥ÁáüÊ•≠È°ç",
"Voucher|n.|ÂÑ™ÊÉ†Âà∏|gift voucher^Á¶ÆÂà∏^travel voucher^ÊóÖÈÅäÂà∏^cash voucher^ÁèæÈáëÂà∏",
"Workshop|n.|Á†îË®éÊúÉ|training workshop^ÂüπË®ìÁ†îË®éÊúÉ^attend workshop^ÂèÉÂä†Á†îË®éÊúÉ^run a workshop^ËàâËæ¶Á†îË®éÊúÉ",
"Apartment|n.|ÂÖ¨ÂØì|rent apartment^ÁßüÂÖ¨ÂØì^apartment building^ÂÖ¨ÂØìÂ§ßÊ®ì^studio apartment^Â•óÊàø",
"Architect|n.|Âª∫ÁØâÂ∏´|famous architect^ËëóÂêçÂª∫ÁØâÂ∏´^chief architect^È¶ñÂ∏≠Âª∫ÁØâÂ∏´^landscape architect^ÊôØËßÄÂª∫ÁØâÂ∏´",
"Construction|n.|Âª∫ÁØâ|under construction^ÊñΩÂ∑•‰∏≠^construction site^Â∑•Âú∞^construction worker^Âª∫ÁØâÂ∑•‰∫∫",
"Elevator|n.|ÈõªÊ¢Ø|take elevator^Êê≠ÈõªÊ¢Ø^elevator pitch^ÈõªÊ¢ØÁ∞°Â†±^freight elevator^Ë≤®Ê¢Ø",
"Estate|n.|Âú∞Áî¢|real estate^ÊàøÂú∞Áî¢^industrial estate^Â∑•Ê•≠ÂçÄ^housing estate^‰ΩèÂÆÖÂçÄ",
"Furniture|n.|ÂÆ∂ÂÖ∑|office furniture^Ëæ¶ÂÖ¨ÂÆ∂ÂÖ∑^antique furniture^Âè§Ëë£ÂÆ∂ÂÖ∑^move furniture^Êê¨ÂÆ∂ÂÖ∑",
"Property|n.|Ë≤°Áî¢|private property^ÁßÅ‰∫∫Ë≤°Áî¢^intellectual property^Êô∫ÊÖßË≤°Áî¢^property tax^Ë≤°Áî¢Á®Ö",
"Resident|n.|Â±ÖÊ∞ë|local resident^Áï∂Âú∞Â±ÖÊ∞ë^permanent resident^Ê∞∏‰πÖÂ±ÖÊ∞ë^resident permit^Â±ÖÁïôË≠â",
"Structure|n.|ÁµêÊßã|organization structure^ÁµÑÁπîÁµêÊßã^steel structure^ÈãºÁµêÊßã^price structure^ÂÉπÊ†ºÁµêÊßã",
"Accountant|n.|ÊúÉË®à|chartered accountant^ÁâπË®±ÊúÉË®àÂ∏´^hire accountant^ËÅòË´ãÊúÉË®à^chief accountant^ÊúÉË®à‰∏ª‰ªª",
"Chef|n.|‰∏ªÂªö|head chef^Ë°åÊîø‰∏ªÂªö^sous chef^ÂâØ‰∏ªÂªö^pastry chef^ÁîúÈªûÂ∏´",
"Mechanic|n.|ÊäÄÂ∑•|car mechanic^Ê±ΩËªäÊäÄÂ∑•^auto mechanic^Ê±ΩËªäÁ∂≠‰øÆÂ∑•^call mechanic^Âè´ÊäÄÂ∑•",
"Plumber|n.|Ê∞¥ÈõªÂ∑•|call plumber^Âè´Ê∞¥ÈõªÂ∑•^master plumber^Ë≥áÊ∑±Ê∞¥ÈõªÂ∑•^plumber tools^Ê∞¥ÈõªÂ∑•ÂÖ∑",
"Politician|n.|ÊîøÂÆ¢|local politician^Âú∞ÊñπÊîøÂÆ¢^corrupt politician^ËÖêÊïóÊîøÂÆ¢^career politician^ËÅ∑Ê•≠ÊîøÂÆ¢",
"Professor|n.|ÊïôÊéà|university professor^Â§ßÂ≠∏ÊïôÊéà^assistant professor^Âä©ÁêÜÊïôÊéà^retired professor^ÈÄÄ‰ºëÊïôÊéà",
"Receptionist|n.|Ê´ÉÂè∞|hotel receptionist^È£ØÂ∫óÊ´ÉÂè∞^medical receptionist^Ë®∫ÊâÄÊ´ÉÂè∞^ask receptionist^ÂïèÊ´ÉÂè∞",
"Scientist|n.|ÁßëÂ≠∏ÂÆ∂|research scientist^Á†îÁ©∂ÁßëÂ≠∏ÂÆ∂^social scientist^Á§æÊúÉÁßëÂ≠∏ÂÆ∂^data scientist^Êï∏ÊìöÁßëÂ≠∏ÂÆ∂",
"Secretary|n.|ÁßòÊõ∏|private secretary^ÁßÅ‰∫∫ÁßòÊõ∏^legal secretary^Ê≥ïÂæãÁßòÊõ∏^executive secretary^Ë°åÊîøÁßòÊõ∏",
"Airport|n.|Ê©üÂ†¥|international airport^ÂúãÈöõÊ©üÂ†¥^airport shuttle^Ê©üÂ†¥Êé•ÈßÅ^airport security^Ê©üÂ†¥ÂÆâÊ™¢",
"Baggage|n.|Ë°åÊùé|baggage claim^Ë°åÊùéÊèêÈ†ò^excess baggage^Ë∂ÖÈáçË°åÊùé^check baggage^ÊâòÈÅãË°åÊùé",
"Cancel|v.|ÂèñÊ∂à|cancel flight^ÂèñÊ∂àÁè≠Ê©ü^cancel reservation^ÂèñÊ∂àÈ†êÁ¥Ñ^cancel meeting^ÂèñÊ∂àÊúÉË≠∞",
"Delay|n.|Âª∂Ë™§|flight delay^Áè≠Ê©üÂª∂Ë™§^traffic delay^‰∫§ÈÄöÂª∂Ë™§^without delay^ÊØ´‰∏çÂª∂ÈÅ≤",
"Depart|v.|Âá∫Áôº|depart on time^Ê∫ñÊôÇÂá∫Áôº^depart from^Âæû...Âá∫Áôº^flight departs^Áè≠Ê©üËµ∑È£õ",
"Destination|n.|ÁõÆÁöÑÂú∞|final destination^ÊúÄÁµÇÁõÆÁöÑÂú∞^tourist destination^ÊóÖÈÅäÂãùÂú∞^reach destination^ÊäµÈÅîÁõÆÁöÑÂú∞",
"Flight|n.|Áè≠Ê©ü|book flight^Ë®ÇÊ©üÁ•®^connecting flight^ËΩâÊ©ü^cancel flight^ÂèñÊ∂àÁè≠Ê©ü",
"Luggage|n.|Ë°åÊùé|hand luggage^ÊâãÊèêË°åÊùé^lost luggage^ÈÅ∫Â§±Ë°åÊùé^pack luggage^ÊâìÂåÖË°åÊùé",
"Passport|n.|Ë≠∑ÁÖß|valid passport^ÊúâÊïàË≠∑ÁÖß^renew passport^ÊèõË≠∑ÁÖß^passport control^Ë≠∑ÁÖßÊü•È©ó",
"Reservation|n.|È†êÁ¥Ñ|make reservation^È†êÁ¥Ñ^confirm reservation^Á¢∫Ë™çÈ†êÁ¥Ñ^cancel reservation^ÂèñÊ∂àÈ†êÁ¥Ñ",
"Route|n.|Ë∑ØÁ∑ö|bus route^ÂÖ¨ËªäË∑ØÁ∑ö^scenic route^È¢®ÊôØË∑ØÁ∑ö^plan route^Ë¶èÂäÉË∑ØÁ∑ö",
"Shuttle|n.|Êé•ÈßÅËªä|shuttle bus^Êé•ÈßÅÂ∑¥Â£´^space shuttle^Â§™Á©∫Ê¢≠^airport shuttle^Ê©üÂ†¥Êé•ÈßÅ",
"Suitcase|n.|ÊâãÊèêÁÆ±|pack suitcase^ÊâìÂåÖÊâãÊèêÁÆ±^heavy suitcase^ÂæàÈáçÁöÑÊâãÊèêÁÆ±^carry suitcase^ÊèêÊâãÊèêÁÆ±",
"Ticket|n.|Á•®|one-way ticket^ÂñÆÁ®ãÁ•®^return ticket^‰æÜÂõûÁ•®^book ticket^Ë®ÇÁ•®",
"Tour|n.|ÊóÖÈÅä|guided tour^Â∞éË¶Ω^city tour^ÂüéÂ∏ÇÊóÖÈÅä^world tour^‰∏ñÁïåÂ∑°Ëø¥",
"Visa|n.|Á∞ΩË≠â|tourist visa^ËßÄÂÖâÁ∞ΩË≠â^apply for visa^Áî≥Ë´ãÁ∞ΩË≠â^student visa^Â≠∏ÁîüÁ∞ΩË≠â",
"Appliance|n.|ÂÆ∂Èõª|kitchen appliance^ÂªöÊàøÂÆ∂Èõª^household appliance^ÂÆ∂Áî®ÈõªÂô®^electrical appliance^ÈõªÂô®",
"Attire|n.|ÊúçË£ù|formal attire^Ê≠£ÂºèÊúçË£ù^business attire^ÂïÜÂãôÊúçË£ù^proper attire^ÈÅ©Áï∂ÊúçË£ù",
"Beverage|n.|È£≤Êñô|food and beverage^È§êÈ£≤^alcoholic beverage^Âê´ÈÖíÁ≤æÈ£≤Êñô^hot beverage^ÁÜ±È£≤",
"Catering|n.|Â§ñÁá¥|catering service^Â§ñÁá¥ÊúçÂãô^catering company^Â§ñÁá¥ÂÖ¨Âè∏^provide catering^Êèê‰æõÂ§ñÁá¥",
"Commute|v.|ÈÄöÂã§|daily commute^ÊØèÊó•ÈÄöÂã§^long commute^Èï∑ÈÄîÈÄöÂã§^commute to work^ÈÄöÂã§‰∏äÁè≠",
"Currency|n.|Ë≤®Âπ£|foreign currency^Â§ñÂπ£^local currency^Áï∂Âú∞Ë≤®Âπ£^currency exchange^Ë≤®Âπ£ÂÖåÊèõ",
"Deduction|n.|Êâ£Èô§|tax deduction^Á®ÖÊî∂Êâ£Èô§^salary deduction^Ëñ™Ë≥áÊâ£Èô§^standard deduction^Ê®ôÊ∫ñÊâ£Èô§",
"Duration|n.|ÊúüÈñì|short duration^Áü≠ÊúüÈñì^duration of stay^ÂÅúÁïôÊúüÈñì^average duration^Âπ≥ÂùáÊúüÈñì",
"Fare|n.|Á•®ÂÉπ|bus fare^ÂÖ¨ËªäÁ•®ÂÉπ^train fare^ÁÅ´ËªäÁ•®ÂÉπ^air fare^Ê©üÁ•®ÂÉπÊ†º",
"Landmark|n.|Âú∞Ê®ô|famous landmark^ËëóÂêçÂú∞Ê®ô^historic landmark^Ê≠∑Âè≤Âú∞Ê®ô^city landmark^ÂüéÂ∏ÇÂú∞Ê®ô",
"Scenery|n.|È¢®ÊôØ|beautiful scenery^ÁæéÈ∫óÈ¢®ÊôØ^mountain scenery^Â±±ÊôØ^enjoy scenery^Ê¨£Ë≥ûÈ¢®ÊôØ",
"Transit|n.|ÈÅãËº∏|public transit^Â§ßÁúæÈÅãËº∏^in transit^ÈÅãËº∏‰∏≠^mass transit^Â§ßÁúæÊç∑ÈÅã",
"Cubicle|n.|ÈöîÈñì|office cubicle^Ëæ¶ÂÖ¨ÈöîÈñì^work in cubicle^Âú®ÈöîÈñìÂ∑•‰Ωú^cubicle wall^ÈöîÈñìÁâÜ",
"Document|n.|Êñá‰ª∂|sign document^Á∞ΩÁΩ≤Êñá‰ª∂^legal document^Ê≥ïÂæãÊñá‰ª∂^attach document^ÈôÑÂä†Êñá‰ª∂",
"Folder|n.|Ë≥áÊñôÂ§æ|file folder^Ê™îÊ°àÂ§æ^new folder^Êñ∞Ë≥áÊñôÂ§æ^organize folder^Êï¥ÁêÜË≥áÊñôÂ§æ",
"Photocopier|n.|ÂΩ±Âç∞Ê©ü|use photocopier^Áî®ÂΩ±Âç∞Ê©ü^jammed photocopier^Âç°Á¥ôÁöÑÂΩ±Âç∞Ê©ü^color photocopier^ÂΩ©Ëâ≤ÂΩ±Âç∞Ê©ü",
"Presentation|n.|Á∞°Â†±|give presentation^ÂÅöÁ∞°Â†±^slide presentation^ÊäïÂΩ±ÁâáÁ∞°Â†±^oral presentation^Âè£È†≠Á∞°Â†±",
"Stationery|n.|ÊñáÂÖ∑|office stationery^Ëæ¶ÂÖ¨ÊñáÂÖ∑^stationery shop^ÊñáÂÖ∑Â∫ó^order stationery^Ë®ÇË≥ºÊñáÂÖ∑",
"Applicant|n.|Áî≥Ë´ã‰∫∫|job applicant^Ê±ÇËÅ∑ËÄÖ^successful applicant^ÈåÑÂèñËÄÖ^screen applicants^ÁØ©ÈÅ∏Áî≥Ë´ã‰∫∫",
"Assistant|n.|Âä©ÁêÜ|personal assistant^ÁßÅ‰∫∫Âä©ÁêÜ^executive assistant^Ë°åÊîøÂä©ÁêÜ^research assistant^Á†îÁ©∂Âä©ÁêÜ",
"Certificate|n.|Ë≠âÊõ∏|birth certificate^Âá∫ÁîüË≠âÊòé^medical certificate^Ë®∫Êñ∑Êõ∏^gift certificate^Á¶ÆÂà∏",
"Director|n.|Á∏ΩÁõ£|marketing director^Ë°åÈä∑Á∏ΩÁõ£^board of directors^Ëë£‰∫ãÊúÉ^managing director^Á∏ΩÁ∂ìÁêÜ",
"Occupation|n.|ËÅ∑Ê•≠|current occupation^ÁõÆÂâçËÅ∑Ê•≠^state occupation^Ë™™ÊòéËÅ∑Ê•≠^hazardous occupation^Âç±Èö™ËÅ∑Ê•≠",
"Supervisor|n.|‰∏ªÁÆ°|direct supervisor^Áõ¥Â±¨‰∏ªÁÆ°^report to supervisor^Âêë‰∏ªÁÆ°Â†±Âëä^shift supervisor^ÂÄºÁè≠‰∏ªÁÆ°",
"Ambitious|adj.|ÊúâÈáéÂøÉ|ambitious goal^ÈáéÂøÉÂãÉÂãÉÁöÑÁõÆÊ®ô^ambitious plan^ÂÆèÂ§ßÁöÑË®àÁï´^ambitious young man^ÊúâÁÇ∫ÈùíÂπ¥",
"Cautious|adj.|Ë¨πÊÖéÁöÑ|be cautious^Ë¨πÊÖé^cautious approach^Ë¨πÊÖéÁöÑÊñπÊ≥ï^cautious optimism^ÂØ©ÊÖéÊ®ÇËßÄ",
"Diligent|adj.|Âã§ÂãâÁöÑ|diligent student^Âã§ÂãâÁöÑÂ≠∏Áîü^diligent worker^Âã§ÂãûÁöÑÂ∑•‰∫∫^do diligently^Âã§Â•ÆÂú∞ÂÅö",
"Punctual|adj.|Ê∫ñÊôÇÁöÑ|be punctual^Ë¶ÅÊ∫ñÊôÇ^always punctual^Á∏ΩÊòØÊ∫ñÊôÇ^punctual arrival^Ê∫ñÊôÇÂà∞ÈÅî"
];

// Ëß£ÊûêË≥áÊñôÂ∫´
const DB = RAW.map(line => {
    const p = line.split('|');
    const sents = p[4].split('^');
    let formattedSents = [];
    for(let i=0; i<sents.length; i+=2) {
        if(sents[i+1]) formattedSents.push({ en: sents[i], cn: sents[i+1] });
    }
    return { w: p[0], t: p[1], m: p[2], sentences: formattedSents };
});

// ÈÅäÊà≤Ê†∏ÂøÉÈÇèËºØ
const GRID = 15;
const TILE = 6.666;
const STATE = { lv:1, hp:3, key:0, pause:false, bombs:1, range:2, ammo:5 }; 
let map=[], enemies=[], bombs=[], player={gx:1,gy:1}, curQ=null;
const input = {u:false,d:false,l:false,r:false};

const dom = {
    grid: document.getElementById('layer-grid'),
    item: document.getElementById('layer-item'),
    obj: document.getElementById('layer-obj'),
    ent: document.getElementById('layer-ent'),
    player: document.getElementById('player'),
    quiz: document.getElementById('quiz-layer'),
    hud: { hp: document.getElementById('ui-hp'), lv: document.getElementById('ui-lv'), key: document.getElementById('ui-key'), ammo: document.getElementById('ui-ammo') },
    q: { w: document.getElementById('q-w'), t: document.getElementById('q-t'), box: document.getElementById('opt-box') },
    learn: document.getElementById('learn-area'),
    learnContent: document.getElementById('sent-content'),
    closeBtn: document.getElementById('close-quiz-btn')
};

// ËºâÂÖ•ÂúñÁâá (ÁßªÈô§Â§ñÈÉ®‰æùË≥¥Ôºå‰ΩøÁî®ÂÖßÂª∫Ë≤ìÂí™)
dom.player.innerText = 'üê±';

function init() { startLevel(1); loop(); }

function startLevel(lv) {
    STATE.lv = lv; STATE.key = 0; STATE.pause = false;
    STATE.range = 2 + Math.floor(lv/3);
    
    dom.grid.innerHTML=''; dom.item.innerHTML=''; dom.obj.innerHTML=''; dom.ent.innerHTML='';
    bombs=[]; enemies=[]; map=[];

    for(let y=0; y<GRID; y++) {
        let row = [];
        for(let x=0; x<GRID; x++) {
            const el=document.createElement('div'); el.className='cell';
            el.style.left=(x*TILE)+'%'; el.style.top=(y*TILE)+'%'; el.id=`c-${x}-${y}`;
            if(x===0||x===GRID-1||y===0||y===GRID-1||(x%2===0&&y%2===0)) { row.push(1); el.classList.add('wall'); }
            else if(x<3&&y<3) { row.push(0); }
            else { if(Math.random()<0.3) { row.push(2); el.classList.add('brick'); } else row.push(0); }
            dom.grid.appendChild(el);
        }
        map.push(row);
    }

    let bricks=[]; for(let y=0; y<GRID; y++) for(let x=0; x<GRID; x++) if(map[y][x]===2) bricks.push({x,y});
    if(bricks.length>2) {
        let k=bricks.splice(Math.floor(Math.random()*bricks.length),1)[0]; map[k.y][k.x]=-4;
        let d=bricks.splice(Math.floor(Math.random()*bricks.length),1)[0]; map[d.y][d.x]=-3;
    }

    const count=2+Math.floor(lv/2);
    for(let i=0; i<count; i++) {
        let x,y; do{x=Math.floor(Math.random()*GRID); y=Math.floor(Math.random()*GRID);} while(map[y][x]!==0 || (x<5&&y<5));
        const el=document.createElement('div'); el.className='enemy'; el.innerText=['ü¶†','üëø','üëª'][i%3];
        dom.ent.appendChild(el);
        enemies.push({x,y,el,timer:0,speed:Math.max(10,40-lv*2)});
    }
    updateHUD(); player.gx=1; player.gy=1; updatePlayer();
}

function loop() {
    if(!STATE.pause) { movePlayer(); moveEnemies(); updateBombs(); }
    requestAnimationFrame(loop);
}

let cd=0;
function movePlayer() {
    if(cd>0) {cd--; return;}
    let dx=0,dy=0;
    if(input.u) dy=-1; else if(input.d) dy=1; else if(input.l) dx=-1; else if(input.r) dx=1;
    if(dx||dy) {
        let nx=player.gx+dx, ny=player.gy+dy;
        // Ê†∏ÂøÉ‰øÆÊ≠£ÔºöÈÇäÁïåÊ™¢Êü•
        if(nx<0||nx>=GRID||ny<0||ny>=GRID) return;
        
        let cell=map[ny][nx];
        let bomb=bombs.find(b=>b.x===nx && b.y===ny && !b.pass);
        if((cell<=0||cell===3||cell===4) && !bomb) {
            player.gx=nx; player.gy=ny; updatePlayer(); checkItem(); cd=6;
            bombs.forEach(b=>{if(b.x!==player.gx||b.y!==player.gy) b.pass=false;});
        }
    }
}
function updatePlayer() { dom.player.style.left=(player.gx*TILE)+'%'; dom.player.style.top=(player.gy*TILE)+'%'; }

function moveEnemies() {
    enemies.forEach(e=>{
        if(e.x===player.gx && e.y===player.gy) hitPlayer();
        if(e.timer>0) {e.timer--; return;}
        e.timer=e.speed;
        const dirs=[[0,1],[0,-1],[1,0],[-1,0]];
        let moved=false, tries=0;
        while(!moved && tries<4) {
            let d=dirs[Math.floor(Math.random()*4)];
            let nx=e.x+d[0], ny=e.y+d[1];
            // Ê†∏ÂøÉ‰øÆÊ≠£ÔºöÊÄ™Áâ©ÈÇäÁïåÊ™¢Êü•
            if(nx>=0&&nx<GRID&&ny>=0&&ny<GRID) {
                if(map[ny][nx]<=0 && !bombs.find(b=>b.x===nx&&b.y===ny)) {
                    e.x=nx; e.y=ny; e.el.style.left=(e.x*TILE)+'%'; e.el.style.top=(e.y*TILE)+'%'; moved=true;
                }
            }
            tries++;
        }
        if(e.x===player.gx && e.y===player.gy) hitPlayer();
    });
}
function hitPlayer() { STATE.hp--; updateHUD(); if(STATE.hp<=0) { alert('Game Over!'); startLevel(STATE.lv); STATE.hp=3; updateHUD(); } }

function checkItem() {
    let c=map[player.gy][player.gx];
    if(c===4) { STATE.key=1; map[player.gy][player.gx]=0; document.getElementById(`item-${player.gx}-${player.gy}`).remove(); updateHUD(); }
    else if(c===3 && STATE.key) { alert('Level Up!'); startLevel(STATE.lv+1); }
}

function placeBomb() {
    if(STATE.pause) return;
    if(STATE.ammo<=0) { let b=document.getElementById('reload-btn'); b.style.background='red'; setTimeout(()=>b.style.background='#0984e3',200); return; }
    if(bombs.find(b=>b.x===player.gx && b.y===player.gy)) return;
    STATE.ammo--; updateHUD();
    const el=document.createElement('div'); el.className='bomb';
    el.style.left=(player.gx*TILE)+'%'; el.style.top=(player.gy*TILE)+'%';
    dom.obj.appendChild(el);
    bombs.push({x:player.gx, y:player.gy, el:el, tick:180, pass:true});
}

function updateBombs() {
    for(let i=bombs.length-1; i>=0; i--) {
        let b=bombs[i]; if(!STATE.pause) b.tick--;
        if(b.tick<=0) { explode(b); bombs.splice(i,1); }
    }
}

function explode(b) {
    b.el.remove();
    let hits=[{x:b.x, y:b.y}];
    [[0,1],[0,-1],[1,0],[-1,0]].forEach(d=>{
        for(let i=1; i<=STATE.range; i++) {
            let nx=b.x+d[0]*i, ny=b.y+d[1]*i;
            // Ê†∏ÂøÉ‰øÆÊ≠£ÔºöÁÅ´ÂÖâÈÇäÁïåÊ™¢Êü• (Èò≤Ê≠¢Âç°Ê≠ªÁöÑ‰∏ªÂõ†)
            if(nx<0||nx>=GRID||ny<0||ny>=GRID) break;
            
            if(map[ny][nx]===1) break;
            hits.push({x:nx, y:ny});
            if(map[ny][nx]===2 || map[ny][nx]<0) { breakBrick(nx,ny); break; }
        }
    });
    hits.forEach(h=>{
        const f=document.createElement('div'); f.className='fire';
        f.style.left=(h.x*TILE)+'%'; f.style.top=(h.y*TILE)+'%';
        dom.obj.appendChild(f); setTimeout(()=>f.remove(), 500);
        if(player.gx===h.x && player.gy===h.y) hitPlayer();
        for(let i=enemies.length-1; i>=0; i--) { if(enemies[i].x===h.x && enemies[i].y===h.y) { enemies[i].el.remove(); enemies.splice(i,1); }}
    });
}

function breakBrick(x,y) {
    const el=document.getElementById(`c-${x}-${y}`); el.className='cell';
    if(map[y][x]===-4) { map[y][x]=4; const i=document.createElement('div'); i.className='cell key'; i.innerText='üîë'; i.id=`item-${x}-${y}`; i.style.left=(x*TILE)+'%'; i.style.top=(y*TILE)+'%'; dom.item.appendChild(i); }
    else if(map[y][x]===-3) { map[y][x]=3; el.classList.add('door'); el.innerText='üö™'; }
    else map[y][x]=0;
}

function triggerQuiz() {
    STATE.pause=true; dom.quiz.style.display='flex';
    dom.learn.style.display='none'; dom.closeBtn.style.display='none'; dom.q.box.style.display='grid';
    
    const q = DB[Math.floor(Math.random()*DB.length)]; curQ=q;
    dom.q.w.innerText=q.w; dom.q.t.innerText=q.t;
    
    let opts=[q.m]; while(opts.length<4) { let r=DB[Math.floor(Math.random()*DB.length)].m; if(!opts.includes(r)) opts.push(r); }
    opts.sort(()=>Math.random()-0.5);
    
    dom.q.box.innerHTML='';
    opts.forEach(o=>{
        const b=document.createElement('div'); b.className='opt-btn'; b.innerText=o;
        b.onclick=()=>check(o,b); dom.q.box.appendChild(b);
    });
    speak('word');
}

function check(ans, btn) {
    if(ans===curQ.m) {
        btn.classList.add('correct');
        // ‚òÖ Ê†∏ÂøÉ‰øÆÊ≠£Ôºö‰∏çËá™ÂãïÈóúÈñâÔºåÈ°ØÁ§∫‰æãÂè• ‚òÖ
        dom.q.box.style.display='none';
        dom.learn.style.display='block';
        dom.closeBtn.style.display='block';
        
        let html = '';
        curQ.sentences.forEach(s => {
            html += `<div class="sent-row"><div class="en-text">${s.en}</div><div class="cn-text">${s.cn}</div></div>`;
        });
        dom.learnContent.innerHTML = html;
        
        speak('sent');
    } else {
        btn.classList.add('wrong'); speakText("Try again");
    }
}

function closeQuiz() {
    STATE.ammo += 5; updateHUD(); // ÁçéÂãµ
    dom.quiz.style.display='none'; STATE.pause=false;
}

function updateHUD() { dom.hud.hp.innerText=STATE.hp; dom.hud.lv.innerText=STATE.lv; dom.hud.key.innerText=STATE.key; dom.hud.ammo.innerText=STATE.ammo; }
function speak(type) {
    window.speechSynthesis.cancel();
    let txt = "";
    if(type==='word') txt = curQ.w;
    else if(type==='sent') curQ.sentences.forEach(s => txt += s.en + ". ");
    const u=new SpeechSynthesisUtterance(txt); u.lang='en-US'; window.speechSynthesis.speak(u);
}
function speakText(t) { const u=new SpeechSynthesisUtterance(t); u.lang='en-US'; window.speechSynthesis.speak(u); }

window.onkeydown=e=>{if(e.key.includes('Arrow')) input[e.key[5].toLowerCase()]=true; if(e.key==' ') placeBomb();}
window.onkeyup=e=>{if(e.key.includes('Arrow')) input[e.key[5].toLowerCase()]=false;}

init();
</script>
</body>
</html>
